#!/bin/bash
# Скрипт для компиляции LaTeX-проекта с помощью Docker.
# Использование: ./compile.sh reports/имя_папки_с_работой

###################################################################################################
# Перед первым использованием в Linux/macOS/WSL сделайте скрипт исполняемым: chmod +x compile.sh. #
###################################################################################################

# Проверка, был ли передан аргумент
if [ -z "$1" ]; then
    echo "Ошибка: Укажите путь к папке с работой."
    echo "Пример: ./compile.sh reports/lab_01_example"
    exit 1
fi

# Имя для нашего Docker-образа
IMAGE_NAME="latex-compiler-env"

# Проверяем, существует ли образ, и если нет - собираем его
if [[ "$(docker images -q $IMAGE_NAME 2> /dev/null)" == "" ]]; then
  echo "Образ $IMAGE_NAME не найден. Начинаю сборку..."
  docker build -t $IMAGE_NAME .
fi

echo "Запускаю компиляцию в папке: $1"

# Запускаем контейнер Docker
# -u "$(id -u):$(id -g)" создает файлы от имени вашего пользователя, а не root
docker run --rm \
    -u "$(id -u):$(id -g)" \
    -v "$(pwd)":/workdir \
    -w /workdir/"$1" \
    $IMAGE_NAME lualatex main.tex

echo "Компиляция завершена. PDF-файл находится в папке $1."