# LasTeX: Среда автоматизированной верстки отчетов (ГОСТ 7.32-2017)

Проект представляет собой модульную контейнеризированную среду для подготовки технической документации в системе $LaTeX$. Сборка осуществляется внутри изолированного Docker-контейнера через унифицированный интерфейс на Python.

Оформление документов базируется на кастомном классе `etulab.cls`, соответствующем требованиям **ГОСТ 7.32-2017**.

## 1. Системные требования

*   **ОС:** Windows 10/11 (WSL2), Linux или macOS.
*   **ПО:**
    *   [Docker Desktop](https://www.docker.com/products/docker-desktop).
    *   [Python 3.10+](https://www.python.org/).
    *   [VS Code](https://code.visualstudio.com/).
    *   Git.

## 2. Первоначальная настройка

### 2.1. Установка проприетарных шрифтов
Шрифты Times New Roman и JetBrains Mono должны быть размещены в директории `core/fonts/` для их последующей интеграции в Docker-образ.

**Требуемые файлы:**
*   `times.ttf`, `timesbd.ttf`, `timesi.ttf`, `timesbi.ttf`
*   `JetBrainsMono-Regular.ttf`, `JetBrainsMono-Bold.ttf`, и др.

### 2.2. Настройка Git LFS
Для хранения PDF и изображений:
```bash
git lfs install
git lfs track "*.pdf"
git add .gitattributes
```

## 3. Структура проекта

```text
.
├── core/                 # Ядро системы
│   ├── lib/              # Модули управления (Python)
│   ├── templates/        # Класс etulab.cls и стилевые модули .sty
│   ├── fonts/            # Шрифты для Docker-образа
│   ├── Dockerfile        # Конфигурация среды
│   └── Makefile          # Сценарий сборки
├── reports/              # Рабочая директория (отчеты пользователя)
│   ├── sem_3/            # Архив (v1.0)
│   └── sem_4/            # Актуальные отчеты (v2.0)
├── template/             # Чистый эталонный шаблон _report.tex
├── lastex.py             # Единая точка входа CLI
└── README.md
```

## 4. Порядок работы (CLI)

Управление проектом осуществляется через скрипт `lastex.py`. Скрипт автоматически отслеживает изменения в `Dockerfile`, пересобирает образ и управляет Docker-контейнером в фоновом режиме.

### 4.1. Команды сборки
Сборка конкретного отчета:
```bash
python lastex.py build reports/sem_4/physics/lab_01
```
*Имя выходного файла генерируется автоматически: `sem_4__physics__lab_01.pdf` (в соотв. с путём из примера выше).*

### 4.2. Дополнительные команды
*   `python lastex.py clean <path>` — удаление временных файлов в папке отчета.
*   `python lastex.py status` — проверка состояния Docker-контейнера.
*   `python lastex.py stop` — принудительная остановка фонового контейнера.

## 5. Интеграция с VS Code

Для компиляции по горячим клавишам используется файл `.vscode/tasks.json`.

*   **Build:** `Ctrl + Shift + B` (или `Ctrl + Alt + B` при соответствующей настройке keybindings).
*   **Очистка:** Вызов задачи `Clean Temporary Files`.

Вывод компиляции фильтруется утилитой `texfot`. В консоль выводятся только критические ошибки и предупреждения. Полный лог доступен в директории `out/` конкретной работы.

## 6. Архив (Семестр 3)

Директория `reports/sem_3/` является архивной. Отчеты в ней выполнены по старой технологии (Batch + преамбулы). Для их перекомпиляции требуется ручная адаптация под класс `etulab.cls` или использование старых версий среды из истории Git.

## 7. Устранение неполадок

1.  **Ошибка "command not found":** Убедитесь, что контейнер запущен на актуальном образе (`python lastex.py stop`, затем снова `build`).
2.  **Проблемы с путями:** Всегда используйте относительные пути от корня репозитория.
3.  **Docker:** Если сборка зависла, выполните `docker system prune` (⚠️ удалит все неиспользуемые данные Docker).

## 8. Интеллектуальная подсистема сборки (v2.1)

В текущей версии реализована контекстно-зависимая обработка файлов. Скрипт `lastex.py` анализирует расширение активного файла и выбирает оптимальный сценарий выполнения.

### 8.1. Многофункциональный Hotkey (`Smart Build`)
При использовании `Ctrl + Alt + B` в VS Code система выполняет следующие действия:

1.  **Активный файл `.py`:** Запускается изолированный процесс выполнения только этого скрипта внутри Docker. Результат (график) мгновенно обновляется в директории `pgfs/`. Это позволяет проводить итерационную настройку графиков без пересборки всего отчета.
2.  **Активный файл `.tex`:** Инициируется полная сборка проекта. Скрипт автоматически:
    *   Определяет корень лабораторной работы (ищет `_report.tex` вверх по дереву).
    *   Синхронизирует глобальные настройки `core/matplotlibrc` с контейнером.
    *   Выполняет **все** Python-скрипты в папке проекта.
    *   Компилирует финальный PDF через LuaLaTeX.

### 8.2. Подсистема графики (Python $\rightarrow$ PGF)
Для обеспечения монолитности документа используется векторный формат PGF. Шрифты на графиках автоматически наследуются из основного документа $LaTeX$, что исключает визуальный разнобой.

*   **Автоматизация путей:** Все графики, генерируемые скриптами, автоматически перемещаются в папку `pgfs/` на уровне `_report.tex`.
*   **Использование в тексте:** Подключение графиков осуществляется стандартной командой или использовать сниппет `pgf`:
    ```latex
    \input{pgfs/имя_скрипта.pgf}
    ```
*   **Глобальный конфиг:** Настройки отрисовки (толщина линий, сетка, размеры) вынесены в `core/matplotlibrc`. Скрипты Python должны содержать только логику расчетов и построения, без настроек оформления.

### 8.3. Конфигурация Matplotlib
Глобальная конфигурация в `core/matplotlibrc` настроена на академический стандарт:
*   `backend: pgf` — генерация кода $LaTeX$ вместо растровых изображений.
*   `axes.grid: True` — включение координатной сетки.
*   `figure.autolayout: True` — предотвращение обрезания подписей осей.
*   Синхронизация с Docker-контейнером происходит автоматически при каждом запуске `lastex.py`.

### 8.4. Рекомендации по работе с ИИ
При генерации кода для графиков через нейросетевые модели следует использовать следующий промпт:
> «Напиши Python-скрипт для Matplotlib. Используй только расчетную логику и команды `plt.plot()`. Не настраивай шрифты и размеры. Сохрани результат командой `plt.savefig('filename.pgf')`.»

