%========================================================================================
% КЛАСС ДОКУМЕНТА И ОСНОВНЫЕ ПАРАМЕТРЫ
%========================================================================================
\documentclass[a4paper,14pt,russian]{extarticle}

% Расширяет возможности размеров стандартных классов
\usepackage{extsizes}

% Разрешаем ставить больее длинные пробелы, если иначе не выходит сделать
% более верное разбиение абзаца на строки
\sloppy





%========================================================================================
% ЯЗЫК, ШРИФТЫ И КОДИРОВКА (Современный подход для LuaLaTeX)
%========================================================================================
\usepackage{cmap}           % Обеспечивает правильное отображение шрифтов и символов в PDF
\usepackage{fontspec}       % Пакет для работы с любыми системными шрифтами.
                            % Заменяет устаревшие inputenc и fontenc.
\usepackage[russian]{babel} % Поддержка русского языка: переносы, названия и т.д.

% --- Настройка шрифтов и интервалов
% Явно определяем семейство шрифтов "Times New Roman", указывая путь к файлам
\setmainfont{Times New Roman}[
    Path            = /usr/local/share/fonts/truetype/times-new-roman/, % Путь внутри контейнера
    Extension       = .ttf,
    UprightFont     = times,
    BoldFont        = timesbd,
    ItalicFont      = timesi,
    BoldItalicFont  = timesbi
]
% \setmainfont{TeX Gyre Termes} % Свободный аналог Times New Roman, включенный в TeX Live

% Указываем babel использовать основной шрифт для всех языков по умолчанию
\babelprovide[main]{russian}


\usepackage{setspace}         % Пакет для гибкого управления интервалами
\onehalfspacing               % Установка полуторного межстрочного интервала





%========================================================================================
% СТРАНИЦЫ
%========================================================================================
\usepackage[left=3cm, right=1cm, top=2cm, bottom=2cm]{geometry} % Поля документа
\usepackage{indentfirst}        % Красная строка для первого абзаца после заголовка
\setlength{\parindent}{1.25cm}  % Отступ красной строки - 1.25 см

\usepackage[toc,page]{appendix} % Поддержка приложение в отчете
\usepackage{pdflscape}          % Поддержка горизонтальных страниц

% --- Поддержка колонтитулов
\usepackage{enotez}

\makeatletter % Создание нового стиля для сносок на странице
\def\enotez@endnotes@footer{%
    \begin{center}
        \rule{0.5\linewidth}{0.4pt}
        \enotez@theendnotes
    \end{center}
}

% --- Настройка содержанмя
\usepackage{tocloft}

% Убираем точки между заголовком и номером страницы
\renewcommand{\cftsecleader      }{\hfil} 
\renewcommand{\cftsubsecleader   }{\hfil}
\renewcommand{\cftsubsubsecleader}{\hfil}
% Делаем заголовок оглавления без жирного шрифта
\renewcommand{\cfttoctitlefont}{\normalfont\bfseries\Large\centering}
\renewcommand{\cfttoctitlefont}{\normalfont\Large\bfseries\centering}
% Меняем название на "СОДЕРЖАНИЕ"
\renewcommand{\contentsname}{{\large\uppercase{СОДЕРЖАНИЕ}}}
% Убираем жирный шрифт с разделов и номеров страниц
\renewcommand{\cftsecfont       }{\normalfont} 
\renewcommand{\cftsecpagefont   }{\normalfont}
\renewcommand{\cftsubsecfont    }{\normalfont}
\renewcommand{\cftsubsecpagefont}{\normalfont}


%========================================================================================
% ЗАГОЛОВКИ
%========================================================================================
\usepackage{titlesec}

%titleformat{<команда>     }{<стиль>             }{<номер>           }{<отступ>}{<текст до>}
\titleformat{\section      }{\bfseries\normalsize}{\thesection.      }{1em     }{          }
\titleformat{\subsection   }{\bfseries\normalsize}{\thesubsection.   }{1em     }{          }
\titleformat{\subsubsection}{\bfseries\normalsize}{\thesubsubsection.}{1em     }{          }

\newcommand{\centeredsection}[1]{
    \noindent
    \begin{center}
        \textbf{\normalsize #1}
    \end{center}
    \par
}




%========================================================================================
% МАТЕМАТИКА
%========================================================================================
\usepackage{amsmath}        % Основные математические окружения
\usepackage{amsfonts}       % Математические шрифты
\usepackage{amssymb}        % Дополнительные математические символы
\usepackage{mathtools}      % Расширение для amsmath с исправлением ошибок и новыми командами
\usepackage{icomma}         % Корректная работа запятой как десятичного разделителя в формулах





%========================================================================================
% ГРАФИКА, ТАБЛИЦЫ И ПЛАВАЮЩИЕ ОБЪЕКТЫ
%========================================================================================
\usepackage{graphicx}       % Для вставки изображений
\usepackage{float}          % Для точного позиционирования объектов с опцией [H]
\usepackage{caption}        % Гибкая настройка подписей к рисункам и таблицам

% --- Настройка подписей к рисункам
\captionsetup[figure]{
    justification=centering,   % Выравнивание по центру
    labelsep=endash,           % Разделитель "Рисунок 1 –" (тире)
    singlelinecheck=false,     % Принудительное центрирование даже для коротких подписей
    font=normalsize,           % Обычный размер шрифта (не курсив)
    skip=6pt                   % Отступ после подписи
}

% --- Настройка подписей к таблицам
\captionsetup[table]{
    position=top,              % Подпись над таблицей
    justification=raggedright, % Выравнивание по левому краю
    labelsep=endash,           % Разделитель "Таблица 1 –" (тире)
    singlelinecheck=false,     % Принудительное выравнивание по левому краю
    font=normalsize,           % Обычный размер шрифта (не курсив)
    skip=6pt                   % Отступ перед таблицей
}

% --- Пакеты для качественных таблиц
\usepackage{multirow}       % Улучшенное форматирование таблиц
\usepackage{tabularx}       % Таблицы с автоматическим расчетом ширины колонок
\usepackage{array}          % Расширяет возможности работы с таблицами и выравниваниями
\usepackage{booktabs}       % Профессиональное оформление таблиц (горизонтальные линии \toprule, \midrule, \bottomrule)
\usepackage{makecell}       % Многострочные ячейки в таблицах

% --- Настройка новых типов колонок для tabularx
\renewcommand{\tabularxcolumn}[1]{m{#1}}
\newcolumntype{C}{>{\centering\arraybackslash}X}
\newcolumntype{L}{>{\arraybackslash}X}
\newcolumntype{R}{>{\raggedleft\arraybackslash}X}





%========================================================================================
% ИСХОДНЫЙ КОД
%========================================================================================
\usepackage{listings}       % Для вставки листингов кода
\usepackage{xcolor}         % Для определения цветов

% --- Настройка стиля для листингов
\definecolor{codegray}{gray}{0.95}
\definecolor{codepurple}{rgb}{0.58,0,0.82}
\definecolor{backcolour}{rgb}{0.98,0.98,0.98}

\lstdefinestyle{mystyle}{
    backgroundcolor=\color{backcolour},
    commentstyle=\color{green!50!black},
    keywordstyle=\color{blue},
    numberstyle=\tiny\color{gray},
    stringstyle=\color{codepurple},
    basicstyle=\footnotesize\ttfamily,
    breakatwhitespace=false,
    breaklines=true,
    captionpos=b,
    keepspaces=true,
    numbers=left,
    numbersep=5pt,
    showspaces=false,
    showstringspaces=false,
    showtabs=false,
    tabsize=2,
    frame=single,
    framerule=0.5pt,
    rulecolor=\color{black!20},
    title=\lstname
}
\lstset{style=mystyle} % Применяем стиль по умолчанию

% --- Новая команда для вставки кода из файла
% Использование: \insertcode[caption={Подпись}, label={lbl:code}]{путь/к/файлу.py}
% Код будет автоматически отформатирован, подсвечен синтаксис Python, и пронумерованы строки.
% Язык можно поменять, например: \insertcode[language=C++]{путь/к/файлу.cpp}.
% Т.е. language=Python - это язык по умолчанию, который можно свободно переопределять.
\newcommand{\insertcode}[2][]{\lstinputlisting[language=Python, #1]{#2}}





%========================================================================================
% ССЫЛКИ И НАВИГАЦИЯ
%========================================================================================
\usepackage{hyperref}       % Создание кликабельных ссылок в документе
\hypersetup{
    colorlinks=true,
    linkcolor=black,
    urlcolor=blue,
    citecolor=black
}

\usepackage[russian]{cleveref} % "Умные" ссылки (\cref вместо \ref)
% cleveref автоматически подставляет "рис.", "табл.", "формула"
% Было:  Как видно из рис. \ref{fig:graph} и табл. \ref{tab:my_results}... -> Результат: "Как видно из рис. 1 и табл. 1..."
% Стало: Как видно из \cref{fig:graph}     и \cref{tab:my_results}...      -> Результат: "Как видно из рис. 1 и табл. 1..."
% Настраиваем названия для cleveref
\crefname{figure}{рис.}{рис.}
\Crefname{figure}{Рис.}{Рис.}
\crefname{table}{табл.}{табл.}
\Crefname{table}{Табл.}{Табл.}
\crefname{section}{разд.}{разд.}
\Crefname{section}{Разд.}{Разд.}
\crefname{equation}{формуле}{формулам}
\Crefname{equation}{Формуле}{Формулам}
